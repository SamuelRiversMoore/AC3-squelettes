L.mapbox.accessToken="pk.eyJ1IjoicGllcnJlcGllcnJlcGllcnJlIiwiYSI6IkdXdE5CRFEifQ.3zLbKVYfHituW8BVU-bl5g";var mapBounds=[[8,-70],[-53,-50]];$(function(){$.tablesorter.addParser({id:"dates",is:function(t,e,s,a){return!1},format:function(t,e,s,a){var i=$(s).attr("data-date");return i?(i=i.split(" ")[0],(i=parseInt(i.split("-").join("")))||t):t},parsed:!1,type:"numeric"}),$.tablesorter.addParser({id:"statuts",is:function(t,e,s,a){return!1},format:function(t,e,s,a){return $(s).attr("data-statut")||t},parsed:!1,type:"text"}),$.tablesorter.addParser({id:"personnes",is:function(t,e,s,a){return!1},format:function(t,e,s,a){return $(s).attr("data-personne")||t},parsed:!1,type:"text"})}),$(document).ready(function(){function t(){0!=n&&(n.removeClass("open"),n=!1)}function e(){var t=$(window).width();c=t<=1100?65:0,void 0!==u&&(u.trigger("sticky_kit:detach"),u.stick_in_parent({offset_top:c}))}function s(){if(C.val().length>=1&&y.val().length>=1){var t=w._zoom?w._zoom:5,e=C.val(),s=y.val();i(e,s),w.setView([e,s],t)}else w.fitBounds(mapBounds)}function a(){var t=_.getLatLng();C.val(t.lat),y.val(t.lng)}function i(t,e){void 0!=_&&w.removeLayer(_),(_=L.marker([t,e],{icon:L.mapbox.marker.icon({"marker-color":"08c15f"}),draggable:!0})).addTo(w),_.on("dragend",a),a()}var o=$("body").find(".modal");o.length&&o.is(":visible")&&$("body").addClass("hasModal"),$("#show-menu, #close-menu").on("click",function(){$("#menu").hasClass("shown")?($("body").addClass("menu-opened"),$("#menu").addClass("shown")):($("body").removeClass("menu-opened"),$("#menu").removeClass("shown"))});var n=!1;$(document).on("click",function(e){$(document).find(".message.ok").length&&!s&&$(document).find(".message.ok").remove();var s=!0;if(0!=n)if($(e.target).closest(".select-menu").length){if($(e.target).is("li.status")){var a=$(e.target),i=a.closest(".select-menu"),o=a.parent().find(".selected"),l=a.attr("data-value").replace(" ",""),r=o.attr("data-value");i.attr("data-original").replace(" ","");a.addClass("selected"),o.removeClass("selected"),i.find(".select-title .status").removeClass(r).addClass(l),i.find("select").val(l),i.closest("form").submit(),t()}}else t()}).on("click",".select-title",function(e){$(this).hasClass("open")?t():($(".select-title.open").removeClass("open"),$(this).addClass("open"),n=$(this))}),$(".tabs-wrapper").on("click","#tabs-menu-button",function(){$(this).closest(".tabs-wrapper").toggleClass("openmenu")}),$(".modal").on("click",".bouton.montrer",function(){var t=$(this).attr("data-target");t=document.getElementById(t),$(t).length&&($(t).removeClass("hidden"),AutoComplete.init(),FileUpload.init())}),$(".modal").on("click",".surmodal",function(t){$(this).addClass("hidden")}).on("click",".surmodal>.edition",function(t){t.stopPropagation()}).on("click",".surmodal .bouton.annuler",function(t){t.preventDefault(),$(this).closest(".surmodal").addClass("hidden")}),$(".modal").on("click",".diapositive .supprimer-button",function(){$(this).closest(".diapositive").addClass("deletemode")}).on("click",".diapositive .bouton.annuler",function(){$(this).closest(".diapositive").removeClass("deletemode")}),$(".modal").on("click",".diapositive.fake .bouton.ajouter",function(){$(this).closest(".diapositive").removeClass("fake").addClass("ajout")}).on("click",".diapositive.ajout .bouton.annuler",function(){$(this).closest(".diapositive").removeClass("ajout").addClass("fake")}),Ps.initialize(document.getElementById("menu"),{suppressScrollX:!0});var l={ouvre:function(t){t.addClass("ouvert").siblings(".glomot-contenu").addClass("ouvert")},ferme:function(t,e){1==e&&$("html, body").animate({scrollTop:$(document).scrollTop()-t.parent().height()},0),t.removeClass("ouvert").siblings(".glomot-contenu").removeClass("ouvert")},montre:function(t){$("html, body").animate({scrollTop:t.offset().top-200},0)}};if($("#lexique-lettres").on("click","a",function(t){t.preventDefault(),$("html, body").animate({scrollTop:$($.attr(this,"href")).offset().top-64},250)}),$("#lexique-mots").length){if($("#lexique-mots").find(".lexique-titre.ouvert").length){r=$("#lexique-mots").find(".lexique-titre.ouvert");setTimeout(function(){l.montre(r)},100)}else var r;$("#lexique-mots").on("click","a.lexique-titre",function(t){if(t.preventDefault(),history.pushState({path:this.path},"",this.href),$(this).hasClass("ouvert"))l.ferme($(this),e=!1);else{if(void 0!==r&&r.length>0){if(r.parent().index()-$(this).parent().index()<0)e=!0;else var e=!1;l.ferme(r,e)}r=$(this),l.ouvre(r)}})}$(".slider").slick({dots:!0,infinite:!0,speed:300,prevArrow:'<img class="slider-arrow-left" src="squelettes/assets/images/arrow-left.png">',nextArrow:'<img class="slider-arrow-right" src="squelettes/assets/images/arrow-right.png">',accessibility:!0}),$(".slick-zoom").on("click",function(t){$(".slider").addClass("slick-fullscreen"),$(".slider").slick("setPosition")}),$(".slider").on("click",function(t){$(t.target).hasClass("slick-arrow")||($(t.target).hasClass("slick-slide")||$(t.target).parent().hasClass("slick-slide")?$(".slider").slick("slickNext"):($(this).removeClass("slick-fullscreen"),$(".slider").slick("setPosition")))}),$(document).keyup(function(t){27==t.keyCode&&($(".slider").removeClass("slick-fullscreen"),$(".slider").slick("setPosition"))}),$(".thematique-sommaire a").click(function(e){t(),e.preventDefault();var s=$(this).attr("href");$("html,body").animate({scrollTop:$(s).offset().top},"slow")}),$("#searchbar-button").on("change",function(){$(this).is(":checked")&&$("#menu-searchbar input").focus()}),$("#contenu.compte article.tab table.sortable").each(function(){$(this).tablesorter({headers:{0:{sorter:"statuts"},3:{sorter:"dates"}}})}),$("section.personnes table.sortable").each(function(){$(this).tablesorter({headers:{0:{sorter:"personnes"}}})}),$("body").hasClass("logged")&&!$("#contenu").hasClass("compte")||$("#nav-tabs li a").click(function(e){t(),e.preventDefault(),history.pushState({path:this.path},"",this.href);var s=$(this).closest("#nav-tabs");if($(this).hasClass("bouton")||($(this).hasClass("chapitre")&&$(this).closest(".chapitres").is(":hidden")?$(this).closest(".chapitres").slideDown(300,function(){$(document.body).trigger("sticky_kit:recalc")}):!$(this).hasClass("chapitre")&&!$(this).hasClass("strong")&&$(this).siblings("ul.chapitres").find("a.strong").length<=0&&(s.find(".chapitres").slideUp(300),$(this).next(".chapitres").children().length>=1&&$(this).next(".chapitres").slideDown(300,function(){$(document.body).trigger("sticky_kit:recalc")}))),$(".tabs-wrapper article.tab").hide(),document.getElementById(this.getAttribute("data-cible"))&&(document.getElementById(this.getAttribute("data-cible")).style.display="block"),s.find("li a").removeClass("strong"),$(this).hasClass("titre")?$(this).next(".chapitres").find("li a").first().addClass("strong"):$(this).addClass("strong"),$("#inventaire-thematiques").length){var a=$("#inventaire-thematiques").offset().top;$(document).scrollTop()-a>=100&&$("html,body").animate({scrollTop:a},200)}return s.closest(".tabs-wrapper").removeClass("openmenu"),!1}),$(window).on("resize",function(){e()});var c=0;if($("#nav-tabs").length>0){if(window.location.hash){var d=$("#nav-tabs").find('a[href="'+window.location.hash+'"]');setTimeout(function(){d.trigger("click")},200)}else $("#nav-tabs").find("a.strong").length<=0&&$("#nav-tabs").find("li a").first().trigger("click");e();var u=$("#nav-tabs").stick_in_parent({offset_top:c});$("#nav-tabs").on("sticky_kit:bottom",function(t){$(this).addClass("is_bottom")}).on("sticky_kit:unbottom",function(t){$(this).removeClass("is_bottom")});var m=$("#nav-tabs"),p=m.find("header h5").outerHeight(!0),h=m.find("ul.thematiques>li").last().outerHeight(!0);m.find("ul.thematiques>li").each(function(){p+=h});var f=0;m.find("ul.chapitres").each(function(){var t=$(this).find("li").length;t>f&&(f=t)}),p+=h*f,p+=m.find("#topButton").outerHeight(!0),p+=40,$("#nav-tabs").height()>p&&(p=$("#nav-tabs").height()+40),$("#inventaire-tabs").css("min-height",p).find("article.tab").each(function(){$(this).css("min-height",p)})}if($("#contenu.compte").length>0&&$("#contenu").find(".dashboard .tabs-wrapper")){var v=$("section.dashboard .tabs-wrapper"),b=v.find("#nav-tabs");v.find("article.tab").each(function(){var t=$(this).attr("id").replace("#",""),e=$(this).find("tr>td.statut .select-menu div.status.prop").length;if(e>0){var s=$('<span class="somme status prop" data-count="'+e+'"><span class="count">'+e+"</span></span>");b.find(".item:not(titre)[data-cible="+t+"]").append(s)}}),b.find("li.section").each(function(){var t=$(this),e=0;if(t.find("ul.chapitres span.somme").each(function(){e+=parseInt($(this).attr("data-count"))}),e>0){var s=$('<span class="somme status prop" data-count="'+e+'"><span class="count">'+e+"</span></span>");t.find(".item.titre").append(s)}})}if($("#welcome-map").length>0){(q=L.mapbox.map("welcome-map","mapbox.streets",{zoomControl:!1,attributionControl:!1})).dragging.disable(),q.touchZoom.disable(),q.doubleClickZoom.disable(),q.scrollWheelZoom.disable(),q.boxZoom.disable(),q.keyboard.disable(),q.tap&&q.tap.disable();var g=$(window).width()>=700?4:3;q.setView([-20,-60],g)}if($("#administration-map").length){var k=$("#administration-map").closest("section.row"),C=k.find('input[name="latitude"]'),y=k.find('input[name="longitude"]'),w=L.mapbox.map("administration-map","mapbox.streets",{attributionControl:!1}).fitBounds(mapBounds),x=L.mapbox.geocoderControl("mapbox.places",{keepOpen:!1,autocomplete:!0});x.addTo(w),s(),x.on("select",function(t){var e=t.feature.geometry.coordinates;i(e[1],e[0]),x._toggle()}),C.on("input",function(){s()}),y.on("input",function(){s()});var _}if($("#inventaire-mapbox").length>0){var q=L.mapbox.map("inventaire-mapbox","mapbox.streets",{attributionControl:!1});if(q.scrollWheelZoom.disable(),q.fitBounds(mapBounds),"undefined"!=typeof geojson&&geojson.length>0){var B=L.mapbox.featureLayer().setGeoJSON(geojson).addTo(q);q.fitBounds(B.getBounds(),{padding:L.point(60,60),maxZoom:maxZoom}),B.on("click",function(t){$("#inventaire-carte").hasClass("projet")||(window.location=t.layer.feature.properties.url)}),B.on("mouseover",function(t){t.layer.openPopup()}),B.on("mouseout",function(t){t.layer.closePopup()})}}});